!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Silicagel=t()}(this,(function(){"use strict";let e=0;class t{constructor(){this.id=e++,this.subs=[]}depend(){t.target.addDep(this)}addSub(e){this.subs.push(e)}notify(){this.subs.forEach(e=>e.update())}}class n{constructor(e,t,n){this.depIds={},this.proxy=e,this.cb=n,this.expOrFn=t;const o=this.checkParam(e,t,n);this.val=this.get(o)}checkParam(e,t,n){return e._isObserved?"string"!=typeof t&&"function"!=typeof t?(console.warn(`Watcher need a expression or a function for arguments[1] but got a ${typeof t}.`),!1):"function"==typeof n||(console.warn(`Watcher need a function for arguments[2] but got a ${typeof n}.`),!1):(console.warn("Watcher need an observed object for arguments[0] but got other object,try to use observe method to get an observed object."),!1)}update(){this.run()}addDep(e){this.depIds.hasOwnProperty(e.id)||(e.addSub(this),this.depIds[e.id]=e)}run(){const e=this.get(!0);e!==this.val&&(this.cb.call(this.proxy,e,this.val),this.val=e)}get(e){if(!e)return;let n;if(t.target=this,"function"==typeof this.expOrFn)n=this.expOrFn();else if(this.expOrFn.includes(".")){n=this.expOrFn.split(".").reduce((e,t)=>e[t],this.proxy)}else n=this.proxy[this.expOrFn];return t.target=null,n}}let o=new WeakMap,r=new WeakMap;class s{constructor(e){this.value=e,this.dep=new t,this._proxy=this.proxy(e)}proxy(e){const s=this;let c=o.get(e);return c||(r.has(e)?(console.warn("proxy2Raw"),e):(c=new Proxy(e,{get(e,n,o){t.target&&s.dep.depend();const r=Reflect.get(e,n,o);return"object"==typeof r?i(r):r},set(e,t,n,o){!function(e,t){Object.prototype.hasOwnProperty.call(e,t)}(e,t);if(e[t]===(n=r.get(n)||n))return!0;const i=Reflect.set(e,t,n,o);return s.dep.notify(),i}}),c._isObserved=!0,c.watch=function(e,t){return new n(this,e,t)},o.set(e,c),r.set(c,e),c))}}function i(e){if(e&&"object"==typeof e)return new s(e)._proxy}function c(){}return c.render=function(e,t){if(e&&1===e.nodeType){var o;if(o=t,"[object Object]"===Object.prototype.toString.call(o))return function(e,t){t._isObserved||(t=i(t));let o,r=document.createDocumentFragment();for(;o=e.firstChild;)r.appendChild(o);return function e(o){Array.from(o.childNodes).forEach(o=>{const r=o.textContent,s=/\{\{(.*?)\}\}/g;if(3===o.nodeType&&s.test(r)){!function e(i){o.textContent=r.replace(s,(o,r)=>{i===Symbol.for("replaceText")&&new n(t,r,e);const s=r.split(".").reduce((e,t)=>e[t],t);return s&&s.toString&&s.toString()})}(Symbol.for("replaceText"))}o.childNodes&&o.childNodes.length&&e(o)})}(r),e.appendChild(r),t}(e,t);console.warn("You should provide an plain object for argument[1]. (Silicagel.render)")}else console.warn("You should provide an element node for argument[0]. (Silicagel.render)")},c.observe=i,c.Watcher=n,c}));
