!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e=e||self).Silicagel=t()}(this,(function(){"use strict";let e=0;class t{constructor(){this.id=e++,this.subs=[]}depend(){t.target.addDep(this)}addSub(e){this.subs.push(e)}notify(){this.subs.forEach(e=>e.update())}}class n{constructor(e,t,n){this.depIds={},this.proxy=e,this.cb=n,this.expOrFn=t;const r=this.checkParam(e,t,n);this.val=this.get(r)}checkParam(e,t,n){return e._isObserved?"string"!=typeof t&&"function"!=typeof t?(console.warn(`Watcher need a expression or a function for arguments[1] but got a ${typeof t}.`),!1):"function"==typeof n||(console.warn(`Watcher need a function for arguments[2] but got a ${typeof n}.`),!1):(console.warn("Watcher need an observed object for arguments[0] but got other object,try to use observe method to get an observed object."),!1)}update(){this.run()}addDep(e){this.depIds.hasOwnProperty(e.id)||(e.addSub(this),this.depIds[e.id]=e)}run(){const e=this.get(!0);e!==this.val&&(this.cb.call(this.proxy,e,this.val),this.val=e)}get(e){if(!e)return;let n;if(t.target=this,"function"==typeof this.expOrFn)n=this.expOrFn();else if(this.expOrFn.includes(".")){n=this.expOrFn.split(".").reduce((e,t)=>e[t],this.proxy)}else n=this.proxy[this.expOrFn];return t.target=null,n}}let r=new WeakMap,o=new WeakMap;class s{constructor(e){this.value=e,this.dep=new t,this._proxy=this.proxy(e)}proxy(e){const s=this;let c=r.get(e);return c||(o.has(e)?(console.warn("proxy2Raw"),e):(c=new Proxy(e,{get(e,n,r){t.target&&s.dep.depend();const o=Reflect.get(e,n,r);return"object"==typeof o?i(o):o},set(e,t,n,r){!function(e,t){Object.prototype.hasOwnProperty.call(e,t)}(e,t);if(e[t]===(n=o.get(n)||n))return!0;const i=Reflect.set(e,t,n,r);return s.dep.notify(),i}}),c._isObserved=!0,c.watch=function(e,t){return new n(this,e,t)},r.set(e,c),o.set(c,e),c))}}function i(e){if(e&&"object"==typeof e)return new s(e)._proxy}function c(){}return c.render=function(e,t){if(e&&1===e.nodeType){var r;if(r=t,"[object Object]"===Object.prototype.toString.call(r))return function(e,t){t._isObserved||(t=i(t));let r,o=document.createDocumentFragment();for(;r=e.firstChild;)o.appendChild(r);return function e(r){Array.from(r.childNodes).forEach(r=>{const o=r.textContent,s=/\{\{(.*?)\}\}/g;if(3===r.nodeType&&s.test(o)){!function e(i){r.textContent=o.replace(s,(r,o)=>{i===Symbol.for("replaceText")&&new n(t,o,e);const s=o.split(".").reduce((e,t)=>e[t],t);return s&&s.toString&&s.toString()})}(Symbol.for("replaceText"))}if(1===r.nodeType){const e=r.attributes;Array.from(e).forEach(e=>{let o=e.name,s=e.value;"bind"===o&&(s.includes(".")?r.value=s.split(".").reduce((e,t)=>e[t],t):r.value=t[s],new n(t,s,e=>{r.value=e}),r.addEventListener("input",e=>{s.split(".").reduce((t,n,r,o)=>(r===o.length-1&&(t[n]=e.target.value),t[n]),t)}))})}r.childNodes&&r.childNodes.length&&e(r)})}(o),e.appendChild(o),t}(e,t);console.warn("You should provide an plain object for argument[1]. (Silicagel.render)")}else console.warn("You should provide an element node for argument[0]. (Silicagel.render)")},c.observe=i,c.Watcher=n,c}));
